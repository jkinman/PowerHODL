<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PowerHODL - ETH/BTC Trading System</title>
    
    <!-- External Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    
    <!-- Modular CSS -->
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <header class="header">
        <div class="header-left">
            <div class="logo">PowerHODL</div>
            <span class="nav-item active">Live Trading Dashboard</span>
            <div style="font-size: 12px; color: #fbbf24; margin-top: 4px; font-weight: 500;">
                ðŸŽ¯ Mission: Accumulate BTC through ETH/BTC ratio trading
            </div>
        </div>
        <div class="header-right">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="connection-status">Connected</span>
            </div>
            <span id="last-update">--</span>
        </div>
    </header>

    <div class="main-container">
        <!-- Balance Section -->
        <div class="balance-section">
            <div class="balance-header">
                <div class="balance-title">Total BTC Accumulated</div>
                <div style="display: flex; gap: 10px;">
                    <button class="refresh-btn" onclick="refreshData()">Refresh</button>
                </div>
            </div>
            <div class="total-balance" id="total-balance">0.500000 BTC</div>
            <div class="balance-change positive" id="balance-change">+0.00%</div>
        </div>

        <!-- Assets Grid -->
        <div class="assets-grid">
            <div class="asset-card">
                <div class="asset-header">
                    <div class="asset-name">
                        <span>Bitcoin</span>
                        <span class="asset-symbol">BTC</span>
                    </div>
                    <div class="asset-change positive">+0.00%</div>
                </div>
                <div class="asset-balance" id="btc-balance">0.500000</div>
                <div class="asset-value">Direct BTC Holdings</div>
            </div>

            <div class="asset-card">
                <div class="asset-header">
                    <div class="asset-name">
                        <span>Ethereum</span>
                        <span class="asset-symbol">ETH</span>
                    </div>
                    <div class="asset-change positive">+0.00%</div>
                </div>
                <div class="asset-balance" id="eth-balance">0.5000</div>
                <div class="asset-value">ETH Holdings</div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">BTC Accumulation Over Time</div>
                    <div class="timeframe-selector">
                        <button class="timeframe-btn" data-timeframe="1M">1M</button>
                        <button class="timeframe-btn" data-timeframe="3M">3M</button>
                        <button class="timeframe-btn" data-timeframe="1Y">1Y</button>
                        <button class="timeframe-btn" data-timeframe="2Y">2Y</button>
                        <button class="timeframe-btn active" data-timeframe="ALL">ALL</button>
                    </div>
                </div>
                <div style="height: 300px; position: relative;">
                    <canvas id="balanceChart"></canvas>
                </div>
            </div>

            <div class="trading-signal">
                <div class="signal-header">Current Trading Signal</div>
                <div class="signal-status">
                    <div class="signal-action signal-hold" id="signal-action">HOLD</div>
                    <button class="refresh-btn" onclick="refreshSignal()">Refresh</button>
                </div>
                
                <div class="metric-row">
                    <div class="metric-label">Confidence</div>
                    <div class="metric-value" id="signal-confidence">--</div>
                </div>
                <div class="metric-row">
                    <div class="metric-label">Z-Score</div>
                    <div class="metric-value" id="z-score">--</div>
                </div>
                <div class="metric-row">
                    <div class="metric-label">ETH/BTC Ratio</div>
                    <div class="metric-value" id="eth-btc-ratio">--</div>
                </div>
                <div class="metric-row">
                    <div class="metric-label">Data Age</div>
                    <div class="metric-value" id="data-age">--</div>
                </div>
            </div>
        </div>

        <!-- Historical Charts Grid -->
        <div class="charts-section">
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">ETH/BTC Ratio History</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 12px; color: #b3b3b3;">
                            ðŸ“Š Historical ratio movements - Shows market opportunities
                        </span>
                        <button class="refresh-btn" onclick="refreshHistoricalCharts()">Refresh</button>
                    </div>
                </div>
                <div style="height: 250px; position: relative;">
                    <canvas id="ratioChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">Z-Score History</div>
                    <div style="font-size: 12px; color: #fbbf24;">
                        âš¡ Trading signals: >+1.26 = Sell ETH, <-1.26 = Buy ETH
                    </div>
                </div>
                <div style="height: 250px; position: relative;">
                    <canvas id="zScoreChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Backtest Sandbox Section -->
        <div class="trades-section">
            <div class="trades-header">
                <div class="trades-title">Strategy Testing & Optimization</div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn" id="openBacktestSandbox">ðŸ§ª Backtest Sandbox</button>
                    <button class="btn btn-secondary" onclick="showExtendedDemo()">ðŸ“Š Show Full Year Demo</button>
                </div>
            </div>
            
            <div style="padding: 20px; color: #b3b3b3; text-align: center;">
                <p style="margin-bottom: 10px;">Test different strategy parameters and see historical performance</p>
                <p style="font-size: 14px;">Current Strategy: Z-Score Â±1.26, 49.79% rebalance, 15-day lookback</p>
            </div>
        </div>
    </div>

    <!-- Backtest Sandbox Modal -->
    <div id="backtestSandbox" class="modal">
        <div class="modal-content" style="width: 90%; max-width: 1200px;">
            <div class="modal-header">
                <h3 class="modal-title">ðŸ§ª Backtest Sandbox - Strategy Testing</h3>
                <button class="close">&times;</button>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <!-- Parameters Panel -->
                <div>
                    <h4 style="margin-bottom: 20px; color: #00d4aa;">Strategy Parameters</h4>
                    
                    <div class="form-group">
                        <label class="form-label">Z-Score Threshold</label>
                        <input type="number" id="zScoreThreshold" class="form-control" value="1.26" step="0.01" min="0.5" max="3.0">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Rebalance Percentage (%)</label>
                        <input type="number" id="rebalancePercent" class="form-control" value="49.79" step="0.1" min="10" max="90">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Lookback Window (days)</label>
                        <input type="number" id="lookbackWindow" class="form-control" value="15" step="1" min="5" max="60">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Transaction Cost (%)</label>
                        <input type="number" id="transactionCost" class="form-control" value="1.66" step="0.01" min="0" max="5">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Backtest Period</label>
                        <select id="backtestPeriod" class="form-control">
                            <option value="365">Last 365 days (1 year)</option>
                            <option value="730">Last 730 days (2 years)</option>
                            <option value="1095">Last 1095 days (3 years)</option>
                            <option value="ALL" selected>ALL Available Data</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Starting BTC</label>
                        <input type="number" id="startingBTC" class="form-control" value="0.5" step="0.1" min="0.1" max="10">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Starting ETH</label>
                        <input type="number" id="startingETH" class="form-control" value="0.5" step="0.1" min="0.1" max="100">
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; color: #b3b3b3;">
                            <input type="checkbox" id="useRealData" checked>
                            Use Real Historical Data
                        </label>
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 20px;">
                        <button class="btn" id="runSingleBacktest">ðŸ§ª Run Single Backtest</button>
                        <button class="btn btn-secondary" id="runOptimization10">ðŸ”„ Optimize (10 iterations)</button>
                        <button class="btn btn-secondary" id="runOptimization100">ðŸš€ Optimize (100 iterations)</button>
                    </div>
                </div>

                <!-- Results Panel -->
                <div>
                    <h4 style="margin-bottom: 20px; color: #00d4aa;">Latest Run Details</h4>
                    
                    <div class="results-grid">
                        <div class="result-card">
                            <div class="result-value positive" id="btcGrowth">--</div>
                            <div class="result-label">BTC Growth</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="winRate">--</div>
                            <div class="result-label">Win Rate</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="totalTrades">--</div>
                            <div class="result-label">Total Trades</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value negative" id="maxDrawdown">--</div>
                            <div class="result-label">Max Drawdown</div>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <div id="backtestStatus" style="color: #b3b3b3; font-size: 14px; margin-bottom: 15px;">
                            Ready to run backtest
                        </div>
                    </div>

                    <!-- Optimization Progress -->
                    <div id="optimizationProgress" style="display: none; margin-top: 20px;">
                        <h5 style="margin-bottom: 10px;">Optimization Progress</h5>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Iteration <span id="currentIteration">0</span> of <span id="totalIterations">0</span></span>
                            <span>Best: <span id="bestBtcGrowth">--</span></span>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar" id="progressBar"></div>
                        </div>
                    </div>

                    <!-- Optimization Results -->
                    <div id="optimizationResults" style="display: none; margin-top: 20px;">
                        <h5 style="margin-bottom: 10px;">Optimization Results</h5>
                        <div id="optimizationResultsList" style="max-height: 300px; overflow-y: auto;">
                            <div style="color: #666; text-align: center; padding: 20px;">No optimization runs yet</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modular JavaScript -->
    <script src="/js/utils/simulation.js"></script>
    <script src="/js/api/backtest.js"></script>
    <script src="/js/api/historical.js"></script>
    <script src="/js/components/charts.js"></script>
    <script src="/js/components/dashboard.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>
