<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PowerHODL - ETH/BTC Trading System</title>
    
    <!-- External Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    
    <!-- Modular CSS -->
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <header class="header">
        <div class="header-left">
            <div class="logo">PowerHODL</div>
            <span class="nav-item active">Live Trading Dashboard</span>
            <div style="font-size: 12px; color: #fbbf24; margin-top: 4px; font-weight: 500;">
                ðŸŽ¯ Mission: Accumulate BTC through ETH/BTC ratio trading
            </div>
        </div>
        <div class="header-right">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="connection-status">Connected</span>
            </div>
            <span id="last-update">--</span>
        </div>
    </header>

    <div class="main-container">
        <!-- Balance Section -->
        <div class="balance-section">
            <div class="balance-header">
                <div class="balance-title">Total BTC Accumulated</div>
                <div style="display: flex; gap: 10px;">
                    <button class="refresh-btn" onclick="refreshData()">Refresh</button>
                </div>
            </div>
            <div class="total-balance" id="total-balance">0.500000 BTC</div>
            <div class="balance-change positive" id="balance-change">+0.00%</div>
        </div>

        <!-- Assets Grid -->
        <div class="assets-grid">
            <div class="asset-card">
                <div class="asset-header">
                    <div class="asset-name">
                        <span>Bitcoin</span>
                        <span class="asset-symbol">BTC</span>
                    </div>
                    <div class="asset-change positive">+0.00%</div>
                </div>
                <div class="asset-balance" id="btc-balance">0.500000</div>
                <div class="asset-value">Direct BTC Holdings</div>
            </div>

            <div class="asset-card">
                <div class="asset-header">
                    <div class="asset-name">
                        <span>Ethereum</span>
                        <span class="asset-symbol">ETH</span>
                    </div>
                    <div class="asset-change positive">+0.00%</div>
                </div>
                <div class="asset-balance" id="eth-balance">0.5000</div>
                <div class="asset-value">ETH Holdings</div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">BTC Accumulation Over Time</div>
                    <div class="timeframe-selector">
                        <button class="timeframe-btn" data-timeframe="1M">1M</button>
                        <button class="timeframe-btn" data-timeframe="3M">3M</button>
                        <button class="timeframe-btn" data-timeframe="1Y">1Y</button>
                        <button class="timeframe-btn" data-timeframe="2Y">2Y</button>
                        <button class="timeframe-btn active" data-timeframe="ALL">ALL</button>
                    </div>
                </div>
                <div style="height: 300px; position: relative;">
                    <canvas id="balanceChart"></canvas>
                </div>
            </div>

            <div class="trading-signal">
                <div class="signal-header">Current Trading Signal</div>
                <div class="signal-status">
                    <div class="signal-action signal-hold" id="signal-action">HOLD</div>
                    <button class="refresh-btn" onclick="refreshSignal()">Refresh</button>
                </div>
                
                <div class="metric-row">
                    <div class="metric-label">Confidence</div>
                    <div class="metric-value" id="signal-confidence">--</div>
                </div>
                <div class="metric-row">
                    <div class="metric-label">Z-Score</div>
                    <div class="metric-value" id="z-score">--</div>
                </div>
                <div class="metric-row">
                    <div class="metric-label">ETH/BTC Ratio</div>
                    <div class="metric-value" id="eth-btc-ratio">--</div>
                </div>
                <div class="metric-row">
                    <div class="metric-label">Data Age</div>
                    <div class="metric-value" id="data-age">--</div>
                </div>
            </div>
        </div>

        <!-- Historical Charts Grid -->
        <div class="charts-section">
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">ETH/BTC Ratio History</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 12px; color: #b3b3b3;">
                            ðŸ“Š Historical ratio movements - Shows market opportunities
                        </span>
                        <button class="refresh-btn" onclick="refreshHistoricalCharts()">Refresh</button>
                    </div>
                </div>
                <div style="height: 250px; position: relative;">
                    <canvas id="ratioChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">Z-Score History</div>
                    <div style="font-size: 12px; color: #fbbf24;">
                        âš¡ Trading signals: >+1.26 = Sell ETH, <-1.26 = Buy ETH
                    </div>
                </div>
                <div style="height: 250px; position: relative;">
                    <canvas id="zScoreChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Backtest Sandbox Section -->
        <div class="trades-section">
            <div class="trades-header">
                <div class="trades-title">ðŸ§ª Strategy Testing & Optimization</div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary" onclick="document.getElementById('backtestControls').scrollIntoView({behavior: 'smooth'})">â¬‡ Jump to Controls</button>
                </div>
            </div>
            
            <div id="backtestSandbox" style="display: grid; grid-template-columns: 1fr 2fr; gap: 30px; padding: 20px;">
                <!-- Parameters Panel -->
                <div id="backtestControls">
                    <h4 style="margin-bottom: 20px; color: #00d4aa;">Strategy Parameters</h4>
                    
                    <div class="form-group">
                        <label class="form-label">Z-Score Threshold</label>
                        <input type="number" id="zScoreThreshold" class="form-control" value="1.26" step="0.01" min="0.5" max="3.0">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Rebalance Percentage (%)</label>
                        <input type="number" id="rebalancePercent" class="form-control" value="49.79" step="0.1" min="10" max="90">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Lookback Window (days)</label>
                        <input type="number" id="lookbackWindow" class="form-control" value="15" step="1" min="5" max="60">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Transaction Cost (%)</label>
                        <input type="number" id="transactionCost" class="form-control" value="1.66" step="0.01" min="0" max="5">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Backtest Period</label>
                        <select id="backtestPeriod" class="form-control">
                            <option value="365">Last 365 days (1 year)</option>
                            <option value="730">Last 730 days (2 years)</option>
                            <option value="1095">Last 1095 days (3 years)</option>
                            <option value="ALL" selected>ALL Available Data</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Starting BTC</label>
                        <input type="number" id="startingBTC" class="form-control" value="0.5" step="0.1" min="0.1" max="10">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Starting ETH</label>
                        <input type="number" id="startingETH" class="form-control" value="0.5" step="0.1" min="0.1" max="100">
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; color: #b3b3b3;">
                            <input type="checkbox" id="useRealData" checked>
                            Use Real Historical Data
                        </label>
                    </div>

                    <!-- Parameter Presets -->
                    <div style="margin-top: 20px;">
                        <label class="form-label">Quick Presets</label>
                        <div style="display: flex; flex-direction: column; gap: 5px;">
                            <button onclick="loadPreset('conservative')" class="btn btn-secondary" style="text-align: left; font-size: 12px;">Conservative</button>
                            <button onclick="loadPreset('megaOptimal')" class="btn btn-secondary" style="text-align: left; font-size: 12px;">Mega-Optimal (Current)</button>
                            <button onclick="loadPreset('aggressive')" class="btn btn-secondary" style="text-align: left; font-size: 12px;">Aggressive</button>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 20px;">
                        <button class="btn" id="runSingleBacktest">ðŸ§ª Run Single Backtest</button>
                        <button class="btn btn-secondary" id="runOptimization10">ðŸ”„ Optimize (10 iterations)</button>
                        <button class="btn btn-secondary" id="runOptimization100">ðŸš€ Optimize (100 iterations)</button>
                        <button class="btn" onclick="open3DVisualization()" style="background: #8b5cf6; color: #fff;">ðŸŽ¯ 3D Parameter Landscape</button>
                    </div>
                </div>

                <!-- Results Panel -->
                <div>
                    <h4 style="margin-bottom: 20px; color: #00d4aa;">Latest Run Details</h4>
                    
                    <div class="results-grid">
                        <div class="result-card">
                            <div class="result-value positive" id="btcGrowth">--</div>
                            <div class="result-label">BTC Growth</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="winRate">--</div>
                            <div class="result-label">Win Rate</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="totalTrades">--</div>
                            <div class="result-label">Total Trades</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value negative" id="maxDrawdown">--</div>
                            <div class="result-label">Max Drawdown</div>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <div id="backtestStatus" style="color: #b3b3b3; font-size: 14px; margin-bottom: 15px;">
                            Ready to run backtest
                        </div>
                    </div>

                    <!-- Performance Chart -->
                    <div style="margin-top: 20px;">
                        <h5 style="margin-bottom: 10px; color: #00d4aa;">BTC Accumulation Over Time</h5>
                        <div style="position: relative; height: 250px; width: 100%; background: #1a1a1b; border-radius: 6px; border: 1px solid #2d2d30;">
                            <canvas id="backtestChart"></canvas>
                        </div>
                    </div>

                    <!-- Latest Run Parameters & Results -->
                    <div style="margin-top: 20px;">
                        <h5 style="margin-bottom: 10px; color: #00d4aa;">Latest Run Parameters & Results</h5>
                        <div id="latestRunContent" style="background: #1a1a1b; border-radius: 6px; border: 1px solid #2d2d30; padding: 15px; max-height: 200px; overflow-y: auto;">
                            <div style="color: #666; text-align: center; padding: 20px;">Run a backtest to see detailed parameters and results</div>
                        </div>
                    </div>

                    <!-- Optimization Progress -->
                    <div id="optimizationProgress" style="display: none; margin-top: 20px;">
                        <h5 style="margin-bottom: 10px;">Optimization Progress</h5>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Iteration <span id="currentIteration">0</span> of <span id="totalIterations">0</span></span>
                            <span>Best: <span id="bestBtcGrowth">--</span></span>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar" id="progressBar"></div>
                        </div>
                    </div>

                    <!-- Optimization Results -->
                    <div id="optimizationResults" style="display: none; margin-top: 20px;">
                        <h5 style="margin-bottom: 10px;">Optimization Results</h5>
                        <div id="optimizationResultsList" style="max-height: 300px; overflow-y: auto;">
                            <div style="color: #666; text-align: center; padding: 20px;">No optimization runs yet</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- 3D Parameter Visualization Modal -->
    <div id="threeDVisualization" class="modal" style="display: none;">
        <div class="modal-content" style="width: 95%; max-width: 1400px;">
            <div class="modal-header">
                <h3 class="modal-title">ðŸŽ¯ 3D Parameter Landscape</h3>
                <button class="close" onclick="close3DVisualization()">&times;</button>
            </div>
            
            <div style="padding: 20px;">
                <!-- Controls -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px; padding: 15px; background: #252526; border-radius: 8px; border: 1px solid #2d2d30;">
                    <div>
                        <label style="color: #b3b3b3; display: block; margin-bottom: 5px;">Fixed Lookback Window:</label>
                        <input type="range" id="viz3d-lookback" min="5" max="60" value="15" style="width: 100%; margin-bottom: 5px;">
                        <span id="viz3d-lookback-value" style="color: #fbbf24; font-weight: bold;">15 days</span>
                    </div>
                    <div>
                        <label style="color: #b3b3b3; display: block; margin-bottom: 5px;">Fixed Transaction Cost:</label>
                        <input type="range" id="viz3d-txcost" min="0" max="5" step="0.1" value="1.66" style="width: 100%; margin-bottom: 5px;">
                        <span id="viz3d-txcost-value" style="color: #fbbf24; font-weight: bold;">1.66%</span>
                    </div>
                    <div>
                        <label style="color: #b3b3b3; display: block; margin-bottom: 5px;">Surface Resolution:</label>
                        <select id="viz3d-resolution" style="width: 100%; padding: 5px; background: #1a1a1b; color: #ffffff; border: 1px solid #2d2d30; border-radius: 4px;">
                            <option value="low">Low (10x10)</option>
                            <option value="medium" selected>Medium (15x15)</option>
                            <option value="high">High (20x20)</option>
                        </select>
                    </div>
                    <div>
                        <button onclick="generate3DSurface()" style="width: 100%; padding: 8px; background: #00d4aa; color: #000; border: none; border-radius: 6px; font-weight: bold; cursor: pointer;">
                            Generate 3D Surface
                        </button>
                        <button onclick="addOptimizationTrail()" style="width: 100%; padding: 6px; background: #8b5cf6; color: #fff; border: none; border-radius: 4px; font-size: 12px; margin-top: 5px; cursor: pointer;">
                            + Optimization Trail
                        </button>
                    </div>
                </div>
                
                <!-- 3D Plot Container -->
                <div id="threeDPlot" style="width: 100%; height: 600px; background: #1a1a1b; border-radius: 8px; border: 1px solid #2d2d30;">
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666; text-align: center;">
                        <div>
                            <div style="font-size: 24px; margin-bottom: 10px;">ðŸŽ¯</div>
                            <div>Click "Generate 3D Surface" to visualize the parameter landscape</div>
                            <div style="font-size: 12px; margin-top: 10px;">X: Z-Score Threshold, Y: Rebalance %, Z: BTC Growth %</div>
                        </div>
                    </div>
                </div>
                
                <!-- Stats Panel -->
                <div style="margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                    <div style="background: #252526; padding: 15px; border-radius: 8px; border: 1px solid #2d2d30;">
                        <div style="color: #b3b3b3; font-size: 12px; margin-bottom: 5px;">GLOBAL MAXIMUM</div>
                        <div id="global-max" style="color: #00d4aa; font-weight: bold;">--</div>
                        <div id="global-max-params" style="color: #666; font-size: 11px; margin-top: 3px;">--</div>
                    </div>
                    <div style="background: #252526; padding: 15px; border-radius: 8px; border: 1px solid #2d2d30;">
                        <div style="color: #b3b3b3; font-size: 12px; margin-bottom: 5px;">SURFACE POINTS</div>
                        <div id="surface-points" style="color: #fbbf24; font-weight: bold;">--</div>
                        <div style="color: #666; font-size: 11px; margin-top: 3px;">Calculated combinations</div>
                    </div>
                    <div style="background: #252526; padding: 15px; border-radius: 8px; border: 1px solid #2d2d30;">
                        <div style="color: #b3b3b3; font-size: 12px; margin-bottom: 5px;">PERFORMANCE RANGE</div>
                        <div id="performance-range" style="color: #8b5cf6; font-weight: bold;">--</div>
                        <div style="color: #666; font-size: 11px; margin-top: 3px;">Min to Max BTC growth</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modular JavaScript -->
    <script src="/js/utils/datetime-loader.js"></script>
    <script src="/js/utils/simulation.js"></script>
    <script src="/js/api/backtest.js"></script>
    <script src="/js/api/historical.js"></script>
    <script src="/js/components/charts.js"></script>
    <script src="/js/components/3d-visualization.js"></script>
    <script src="/js/components/strategy-presets.js"></script>
    <script src="/js/components/backtest-results.js"></script>
    <script src="/js/components/dashboard.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>
